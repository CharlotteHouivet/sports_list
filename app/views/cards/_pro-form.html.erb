
<div class="container-formulaire">
	<%= form_for(@card, :html => {:id => 'card_form'}) do |f| %>
		<div class="formulaire">
			<div class="step1 step hidden">
					<h2 class="title-formulaire">Offer an experience</h2>
					<div class="input input-labeltop">
						<%= f.text_field :activity_title, placeholder: 'Name of the activity' %>
						<span class="error-message"></span>
					</div>

					<div class="input input-label">
						<%= f.label :Discipline %>
						<div class="checkboxes">
							<%= f.collection_check_boxes :disciplines, @disciplines.order(:name), :id, :name do |b| %>
							<%= b.label(class:"label-checkbox disciplines_checkbox") { b.check_box + b.text } %>
							<% end %>
						</div>
						<span class="error-message">error</span>
					</div>

					<div class="input input-label">
						<%= f.label :Languages %>
						<div class="checkboxes">
							<%= f.collection_check_boxes :spoken_languages, @languages.order(:name), :id, :name do |b| %>
								<%= b.label(class:"label-checkbox languages_checkbox") { b.check_box + b.text } %>
							<% end %>
						</div>
						<span class="error-message">error</span>
					</div>

					<div class="input input-labeltop">
					<%= f.label :short_description %>
						<%= f.text_area :short_description, id: 'short_description', placeholder: 'A short description of your activity - max. 100 characters' %> <!-- any characters (10 - 100) -->
						<span class="error-message">error</span>
					</div>
					<div class="input input-labeltop">
					<%= f.label :long_description %>
						<%= f.text_area :long_description, id: 'long_description', placeholder: 'A complete description of your activity - max. 1000 characters' %> <!-- any characters (300 - 1000) -->
						<span class="error-message">error</span>
					</div>

					<div class="input input-label">
						<%= f.label :organization %>
						<%= f.select :organization, Card.organizations.keys %> <!-- -->
					</div>
					<div class="input input-labeltop">
						<%= f.label :price %>
						<%= f.text_field :price, id: 'price', placeholder: 'Price - ex: 200000' %> <!-- any number (1 - 6) (see with roupies) -->
						<span class="error-message">error</span>
					</div>

					<div class="input input-label">
						<%= f.label :length %>
						<%= f.time_select :length, {start_hour: 0, end_hour: 4, minute_step: 15} %>
						<span class="error-message">error</span>
					</div>

					<div class="input input-label">
						<%= f.label "Opening hour" %>
						<%= f.time_select :opening_hour, {minute_step: 15} %>
					</div>

					<div class="input input-label">
						<%= f.label "Closing hour" %>
						<%= f.time_select :closing_hour, {minute_step: 15} %>
						<span class="error-message">error</span>
					</div>
					<div class="input input-labeltop">
						<%= f.label :photos %>
						<%= f.file_field :photos, id: 'photos', multiple: true %>
					</div>
					<div class="step-nav">
						<button class="btn-step" id="next_step1">Next</button>
					</div>
			</div>

			<div class="step2 step hidden">
				<h2 class="title-formulaire">Your contact information</h2>
				<div class="input input-labeltop">
					<%= f.text_field :whatsapp, id: 'whatsapp', placeholder: 'WhatsApp Number - ex: 0676349823'%> <!-- only numbers between (10 - 14) -->
					<span class="error-message">error</span>
				</div>
				<div class="input input-labeltop">
					<%= f.text_field :facebook, id: 'facebook', placeholder: 'Facebook page - https://www.facebook.com/...' %>
					<span class="error-message">error</span>
				</div>
				<div class="input input-labeltop">
					<%= f.text_field :instagram, id: 'instagram', placeholder: 'Instagram page - https://www.instagram.com/...' %>
					<span class="error-message">error</span>
				</div>
				<div class="step-nav">
					<button id="back_step2" class="btn-step previous">Previous</button>
					<button id="next_step2" class="btn-step">Next</button>
				</div>
			</div>

			<div class="step3 step hidden">
				<h2 class="title-formulaire">Your activity Location</h2>
				<div class="input input-labeltop">
					<%= f.text_field :address, id: 'card_address', placeholder: 'Activity Address' %> <!-- pattern: ???? for the moment -->
					<span class="error-message">error</span>
				</div>
				<div class="input input-labeltop">
				<%= f.label :city %><br>
				<%= f.select :city, Card.cities.keys, {id: "city_input", include_blank: true} %>
				<span class="error-message">error</span><br>
				</div>
				<%= f.hidden_field :country %>
				<div id="map">  <!-- Display Google map -->
				</div>

				<input type="hidden"  id="lat" name="lat" />
				<input type="hidden"  id="lng" name="lng"/>
				<div class="step-nav">
					<button id="back_step3" class="btn-step previous">Previous</button>
					<%= f.submit  "save and publish", class: 'btn-step' %>
				</div>
			</div>
		</div>
	<% end %>
</div>

<script>
$(document).ready(function() {
	$(function(){
		$("#next_step1").click(function(e) {
			e.preventDefault();
			valid = true;
			 var d_checkboxs = document.getElementsByName("card[disciplines][]");
			 var count = 0;
			 for(var i = 0, l = d_checkboxs.length; i < l; i++) {
							if(d_checkboxs[i].checked) {
									count++;
							}
				}
				if(count == 0) {
					$(".disciplines_checkbox").last().next().html("<br>You must select at least one discipline").show();
					valid = false
				}
				else {
					$(".disciplines_checkbox").last().next().html("<br>Invalid field").hide();
				}

				var l_checkboxs = document.getElementsByName("card[spoken_languages][]");
				var count = 0;
				for(var i = 0, l = l_checkboxs.length; i < l; i++) {
					if(l_checkboxs[i].checked) {
						count++;
					}
				}
				if(count == 0) {
					$(".languages_checkbox").last().next().html("<br>You must select at least one language").show();
					valid = false
				}
				else {
					$(".languages_checkbox").last().next().html("<br>Invalid field").hide();
				}

			if ($("#card_activity_title").val().match(/[a-zA-Z0-9\- ]{1,30}/) == null){
				$("#card_activity_title").css("border-color", "#FF0000");
				$("#card_activity_title").next().html("Invalid field").show();
				valid = false;
			}
			else{
				$("#card_activity_title").css("border-color", "#008000");
				$("#card_activity_title").next().html("Invalid field").hide();
			}
			if ($("#short_description").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null){
				$("#short_description").css("border-color", "#FF0000");
				$("#short_description").next().html("Invalid field").show();
				valid = false;
			}
			else{
				$("#short_description").css("border-color", "#008000");
				$("#short_description").next().html("Invalid field").hide();
			}
			if ($("#long_description").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null){
				$("#long_description").css("border-color", "#FF0000");
				$("#long_description").next().html("Invalid field").show();
				valid = false;
			}
			else{
				$("#long_description").css("border-color", "#008000");
				$("#long_description").next().html("Invalid field").hide();
			}
			if ($("#price").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null){
				$("#price").css("border-color", "#FF0000");
				$("#price").next().html("Invalid field").show();
				valid = false;
			}
			else{
				$("#price").css("border-color", "#008000");
				$("#price").next().html("Invalid field").hide();
			}

			if (($('#card_length_4i').val() === "00") && (($('#card_length_5i').val()) === "00")) {
				$('#card_length_5i').next().html('<br>You re activity should last at least 15 minutes').show();
			}
			else {
				$('#card_length_5i').next().html('<br>You re activity should last at least 15 minutes').hide();
			}


			if ($('#card_opening_hour_4i').val() > $('#card_closing_hour_4i').val()) {
				$('#card_closing_hour_5i').next().html('<br>You should open before you close').show();
			}
			else if ($('#card_opening_hour_4i').val() === $('#card_closing_hour_4i').val()) {
				$('#card_closing_hour_5i').next().html('<br>You should be open at least 1 hour').show();
			}
			else
			{
				$('#card_closing_hour_5i').next().html('<br>You should open before you close').hide();
			}

			if (valid === true) {
				$('.step1').hide();
				$('.step2').show();
				$('.step3').hide();
			}
			});
			});
			$("#next_step2").click(function(e){
				e.preventDefault();
				valid = true;
				if ($("#whatsapp").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null){
					$("#whatsapp").css("border-color", "#FF0000");
					$("#whatsapp").next().html("Invalid field").show();
					valid = false;
				} else {
					$("#whatsapp").css("border-color", "#008000");
					$("#whatsapp").next().html("Invalid field").hide();
				}

				if ($("#facebook").val() == "") {
					$("#facebook").css("border-color", "#C0C0C0");
				} else if ($("#facebook").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null) {
					$("#facebook").css("border-color", "#FF0000");
					$("#facebook").next().html("Invalid field").show();
					valid = false;
				} else {
					$("#facebook").css("border-color", "#008000");
					$("#facebook").next().html("Invalid field").hide();
				}

				if ($("#instagram").val() == "") {
					$("#instagram").css("border-color", "#C0C0C0");
				}
				else if ($("#instagram").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null) {
					$("#instagram").css("border-color", "#FF0000");
					$("#instagram").next().html("Invalid field").show();
					valid = false;
				}
				else{
					$("#instagram").css("border-color", "#008000");
					$("#instagram").next().html("Invalid field").hide();
				}
				if (valid === true) {
					$('.step1').hide();
					$('.step2').hide();
					$('.last_buttons').hide();
					$('.step3').show();
				}
			});
			$("#publish").click(function(e){
				valid = true;
				if ($("#address").val().match(/[a-zA-Z0-9\- ]{1,100}/) == null){
					$("#address").css("border-color", "#FF0000");
					$("#address").next().html("Invalid field").show();
					valid = false;
				}
				else {
					$("#address").css("border-color", "#008000");
					$("#address").next().html("Invalid field").hide();
				}
				if ($('#card_city').val() === "") {
					$("#card_city").css("border-color", "FF0000")
					$("#card_city").next().html("Invalid field").show();
					valid = false;
				}
				else {
					$("#card_city").next().html("Invalid field").hide();
				}
				return valid;
			});
		});
</script>
